var chat={};chat.commandType={Connected:1,Disconnected:3,Online:101,Offline:102,BlockUser:103,UnblockUser:104,Typing:201,SendMessage:202,GetMessage:203,ReadMessage:204,PinMessageToTop:205,UnpinMessageFromTop:206,UploadFile:207,DownloadFile:208,CreateGroup:301,DeleteGroup:302,JoinGroup:303,LeaveGroup:304,GetGroups:305,PinToTop:306,UnpinFromTop:307};chat.dataType={Text:0,Json:1,MessagePack:2,Protobuf:3,Blob:4},function(){chat.littleEndian=function(){var n=new ArrayBuffer(2);return new DataView(n).setInt16(0,256,!0),new Int16Array(n)[0]===256}();chat.readyState=3;chat.init=function(){var t=document.location.protocol==="https:"?"wss":"ws",i=document.location.port?":"+document.location.port:"",r=t+"://"+document.location.hostname+i+"/chatws",n=new ReconnectingWebSocket(r,null,{binaryType:"arraybuffer"});n.onconnecting=function(t){chat.readyState=n.readyState;console.log("onconnecting",n.readyState);abp.event.trigger("websocket.onconnecting",t)};n.onopen=function(t){chat.readyState=n.readyState;abp.event.trigger("websocket.onopen",t);console.log("onopen",n.readyState)};n.onmessage=function(n){console.log("onmessage",n);n.data instanceof ArrayBuffer?abp.event.trigger("websocket.onreceivebinary",n.data):n.data instanceof Blob?abp.event.trigger("websocket.onreceiveblob",n.data):abp.event.trigger("websocket.onreceivetext",n.data)};n.onclose=function(t){chat.readyState=n.readyState;abp.event.trigger("websocket.onclose",t);console.log("onclose",n.readyState)};n.onerror=function(n){abp.event.trigger("websocket.onerror",n)};abp.event.on("websocket.sendbinary",function(t){n.send(t)});chat.ws=n};chat.sendCommand=function(n,t,i){var f=new ArrayBuffer(9+i.length),r=new DataView(f),u;for(r.setInt32(0,n,chat.littleEndian),r.setInt8(4,t),r.setInt32(5,i.length,chat.littleEndian),u=0;u<i.length;u++)r.setUint8(u+9,i[u]);chat.ws.send(r)};chat.receiveCommand=function(n){var t=[],i=0,u;t=t.concat(Array.from(new Uint8Array(n)));var r=new DataView(n),f=r.getInt32(0,chat.littleEndian),e=r.getInt8(4,chat.littleEndian);if(i=r.getInt32(5,chat.littleEndian),!(t.length<i+9))return u=t.slice(9,i+9),console.log(i),console.log(t.length),{commandType:f,dataType:e,data:u}};chat.online=function(){chat.ws&&chat.ws.open()};chat.offline=function(){chat.ws&&chat.ws.close()}}();